{{ 'product-tab.css' | asset_url | stylesheet_tag }}
<div class="page-width section-{{ section.id }}-padding">
  <div class="color-{{ section.settings.color_scheme }} gradient ppage-tab-item {% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}">
    <ul class="nav-tabs">
      {% for block in section.blocks %}
        {% if block.settings.tabdesc != blank %}
          <li class="nav-item {% if forloop.index == 1 %}active{% endif %}" data-id="{{ block.id }}-{{ section.id }}">
            {{ block.settings.heading }}
          </li>
        {% endif %}
      {% endfor %}
    </ul>
    <div class="tab-content rte">
      {% for block in section.blocks %}
        <div id="{{ block.id }}-{{ section.id }}" class="tab-pane fade {% if forloop.index == 1 %}active{% endif %}">
          <div class="{% if block.settings.show_image_banner %}content_image grid grid--2-col-desktop{% endif %}">
            <div class="{% if block.settings.show_image_banner %}grid__item{% endif %}">
              {{ block.settings.tabdesc }}
            </div>
            {% if block.settings.show_image_banner %}
              {% if block.settings.image != blank %}
                <div class="grid__item right">
                  {{
                    block.settings.image
                    | image_url: width: 3840
                    | image_tag:
                      loading: 'lazy',
                      width: block.settings.image.width,
                      height: image_height,
                      sizes: sizes,
                      widths: widths
                  }}
                </div>
              {% else %}
                <div class="grid__item right">
                  {% if product.featured_media %}
                    <a href="{{ product.url }}" title="{{ product.title | escape }}" class="">
                      <img
                        loading="lazy"
                        class="img-fluid mx-auto lazyload"
                        srcset="{{ product.featured_media | image_url: width: 500 }} 500w"
                        src="{{ product.featured_media | image_url: width: 500 }}"
                        sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 992px) calc((100vw - 130px) / 4), (min-width: 768px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                        width="500"
                        height="{{ 500 | divided_by: product.featured_media.aspect_ratio | ceil }}"
                      >
                    </a>
                  {% endif %}
                </div>
              {% endif %}
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
  @media screen and (max-width: 991px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 0.5 | round: 0 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 0.5 | round: 0 }}px;
    }
  }
{%- endstyle -%}

<script>
  function reloadJavascript() {
    const tabs = document.querySelector(".ppage-tab-item");
    const tabButton = document.querySelectorAll(".ppage-tab-item .nav-item");
    const contents = document.querySelectorAll(".ppage-tab-item .tab-pane");
    tabs.onclick = e => {
    const id = e.target.dataset.id;
    if (id) {
      tabButton.forEach(btn => {
        btn.classList.remove("active");
      });
      e.target.classList.add("active");

      contents.forEach(content => {
        content.classList.remove("active");
      });
      const element = document.getElementById(id);
      element.classList.add("active");
    }
    };
  };
  document.addEventListener("shopify:section:load", reloadJavascript);
  reloadJavascript();
</script>
{% schema %}
{
  "name": "t:sections.main-product.blocks.product-tab.name",
  "tag": "section",
  "max_blocks": 4,
  "enabled_on": {
    "templates": [
      "product"
    ]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "background-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "tab",
      "name": "t:sections.main-product.blocks.tab.name",
      "settings": [
        {
          "type": "inline_richtext",
          "id": "heading",
          "default": "Product tab",
          "info": "t:sections.main-product.blocks.collapsible_tab.settings.heading.info",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.heading.label"
        },
        {
          "type": "richtext",
          "id": "tabdesc",
          "label": "t:sections.image-with-text.blocks.text.settings.text.label",
          "default": "<p>Add details on availability, style, or even provide a review.</p>"
        },
        {
          "type": "checkbox",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.show_image_banner.label",
          "id": "show_image_banner",
          "default": false
        },
        {
          "type": "image_picker",
          "label": "t:sections.sponsored-product.settings.image.label",
          "id": "image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.main-product.blocks.product-tab.name",
      "blocks": [
        {
          "type": "tab"
        },
        {
          "type": "tab"
        },
        {
          "type": "tab"
        }
      ]
    }
  ]
}
{% endschema %}
