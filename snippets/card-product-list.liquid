{% comment %}
  Renders a product card

  Accepts:
  - card_product: {Object} Product Liquid object (optional)
  - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
  - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
  - show_vendor: {Boolean} Show the product vendor. Default: false
  - show_rating: {Boolean} Show the product rating. Default: false
  - extend_height: {Boolean} Card height extends to available container space. Default: true (optional)
  - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)
  - show_quick_add: {Boolean} Show the quick add button.
  - section_id: {String} The ID of the section that contains this card.
  - horizontal_class: {Boolean} Add a card--horizontal class if set to true. Default: false (optional)
  - horizontal_quick_add: {Boolean} Changes the quick add button styles when set to true. Default: false (optional)

  Usage:
  {% render 'card-product', show_vendor: section.settings.show_vendor %}
{% endcomment %}
{%- if card_product and card_product != empty -%}
  {%- liquid
      assign ratio = 1
      if card_product.featured_media and media_aspect_ratio == 'portrait'
          assign ratio = 0.8
      elsif card_product.featured_media and media_aspect_ratio == 'adapt'
          assign ratio = card_product.featured_media.aspect_ratio
      endif
      if ratio == 0 or ratio == null
          assign ratio = 1
      endif
      assign new_badge_position = settings.new_badge_position
  -%}
  <div class="card-wrapper wbproduct-container product-card-wrapper {% if settings.var_pill_style == 'button' %}background_pill{% endif %}">
    <div class=" card badge-{{ new_badge_position }} card--{{ settings.card_style }} {% if on_img_on_hover %}on_img_on_hover_marquee on_img_on_hover_quicklook{% endif %}
        {% if card_product.featured_media == blank and settings.card_style == 'card' %} blank__image {% endif %}
        {% if card_product.featured_media %} card--media{% else %} card--text{% endif %}
        {% if settings.card_style == 'card' %} color-{{ settings.card_color_scheme }} gradient{% endif %}
        {% if image_shape and image_shape != 'default' %} card--shape{% endif %}
        {% if extend_height %} card--extend-height{% endif %}
        {% if horizontal_class %} card--horizontal{% endif %}" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
      <div class="card__inner wbimgblock {% if settings.card_style == 'standard' %}color-{{ settings.card_color_scheme }} gradient{% endif %}{% if card_product.featured_media or settings.card_style == 'standard' %} ratio{% endif %} {% unless card_product.selected_or_first_available_variant.available %} ratio{% endunless %}" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
        {%- if card_product.featured_media -%}
          {% comment %} Variants Wise Change Product Image {% endcomment %}
          <div id="webipro-{{ section.id }}-{{ card_product.id }}" class="card__media {% if image_shape and image_shape != 'default' %} shape--{{ image_shape }} color-{{ settings.card_color_scheme }} gradient{% endif %}">
              {%- assign media = card_product.selected_or_first_available_variant.featured_media -%}
            <div class="product__media-item" data-media-id="{{ section.id }}-{{ card_product.id }}-{{ media.id }}">
                {% comment %}theme-check-disable ImgLazyLoading{% endcomment %}
                <a href="{{ card_product.url | append: '?variant=' | append: card_product.selected_or_first_available_variant.id | default: '#' }}"
                  title="{{ card_product.title | escape }}"
                  class="media media--transparent media--{{ media_size }} media--hover-effect" {% if media_size == 'adapt' and card_product.featured_media %} style="padding-bottom: {{ 1 | divided_by: featured_media_aspect_ratio | times: 100 }}%;"{% endif %}>
                  <img srcset="{%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | image_url: width: 165 }} 165w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | image_url: width: 360 }} 360w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | image_url: width: 533 }} 533w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | image_url: width: 720 }} 720w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | image_url: width: 940 }} 940w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | image_url: width: 1066 }} 1066w,{%- endif -%}
                  {{ card_product.featured_media | image_url }} {{ card_product.featured_media.width }}w "
                    src="{{ card_product.featured_media | image_url: width: 533 }}"
                    sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 992px) calc((100vw - 130px) / 4), (min-width: 768px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                    alt="{{ card_product.featured_media.alt | escape }}"
                    class="motion-reduce"
                    {% unless lazy_load == false %} loading="lazy"{% endunless %}
                    width="{{ card_product.featured_media.width }}"
                    height="{{ card_product.featured_media.height }}">
                    {%- if card_product.media[1] != nil and show_secondary_image -%}
                      <img srcset="{%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | image_url: width: 165 }} 165w,{%- endif -%}
                      {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | image_url: width: 360 }} 360w,{%- endif -%}
                      {% if card_product.media[1].width >= 493 %}{{ card_product.media[1] | image_url: width: 493 }} 493w,{% endif %}
                      {% if card_product.media[1].width >= 600 %}{{ card_product.media[1] | image_url: width: 600 }} 600w,{% endif %}
                      {% if card_product.media[1].width >= 713 %}{{ card_product.media[1] | image_url: width: 713 }} 713w,{% endif %}
                      {% if card_product.media[1].width >= 823 %}{{ card_product.media[1] | image_url: width: 823 }} 823w,{% endif %}
                      {% if card_product.media[1].width >= 992 %}{{ card_product.media[1] | image_url: width: 992 }} 992w,{% endif %}
                      {{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w"
                       src="{{ card_product.media[1] | image_url: width: 370 }}"
                       alt="{{ card_product.media[1].alt | escape }}"
                       sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 992px) calc((100vw - 130px) / 4), (min-width: 768px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                       class="motion-reduce img-fluid mx-auto lazyload"
                       loading="lazy"
                       width="{{ card_product.media[1].width }}"
                       height="{{ card_product.media[1].height }}">
                    {%- endif -%}
                </a>
            </div>
            
            {% comment %} Cart Button Start {% endcomment %}
            
            <product-form class="{% if on_img_on_hover %}on_img_on_hover {% endif %}no-js-hidden top_atc{% if atc_btn_style == 'text_icon' %} cart_icon{% endif %}" id="ProductInfo-{{ section.id }}-{{ card_product.id }}">
              {%- assign product_form_id = 'product-form-' | append: section.id | append: '-' | append: card_product.id -%}
              {%- form 'product', card_product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
                <input type="hidden" name="id" class="product-variant-id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                {% if atc_btn_position == 'on_img' %}
                  {% if card_product.has_only_default_variant or show_variants == true %}
                  <button id="{{ product_form_id }}-submit" type="submit" name="add"
                    class="add-to-cart__submit button button--primary" aria-haspopup="dialog"
                    aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                    aria-live="polite"
                    data-sold-out-message="true" {% if card_product.selected_or_first_available_variant.available == false %} disabled {% endif %}>
                    {%- if card_product.selected_or_first_available_variant.available -%}
                      <span>{{ 'products.product.add_to_cart' | t }}</span>
                      {% if atc_btn_style == 'text_icon' %}{% render 'icon-hcartbag' %}{% endif %}
                    {%- else -%}
                      <span>{{ 'products.product.sold_out' | t }}</span>
                      {% if atc_btn_style == 'text_icon' %}{% render 'icon-hcartbag' %}{% endif %}
                    {%- endif -%}
                    <span class="sold-out-message hidden">{{ 'products.product.sold_out' | t }}</span>
                    <span class="loading-overlay__spinner hidden">
                      <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"> <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle> </svg>
                    </span>
                  </button>
                  {% else %}
                    <a href="{{ card_product.url }}" class="add-to-cart__submit button button--primary"><span>{{ 'products.product.select_option' | t }}</span></a>
                  {% endif %}
                {% endif %}
                {%- endform -%}
              </product-form>
            {% comment %} Cart Button End {% endcomment %}
            {%- liquid
              assign media_to_render = card_product.featured_media.id
              for variant in card_product.variants
                  assign media_to_render = media_to_render | append: variant.featured_media.id | append: ' '
              endfor
            -%}
            {%- for media in card_product.media -%}
              {%- if media_to_render contains media.id and media.id != card_product.selected_or_first_available_variant.featured_media.id -%}
                <div class="product__media-item" data-media-id="{{ section.id }}-{{ card_product.id }}-{{ media.id }}">
                  <a href="{{ card_product.url | append: '?variant=' | append: card_product.selected_or_first_available_variant.id | default: '#' }}"
                    title="{{ card_product.title | escape }}"
                    class="media media--transparent media--{{ media_size }} media--hover-effect" {% if media_size == 'adapt' and card_product.featured_media %} style="padding-bottom: {{ 1 | divided_by: featured_media_aspect_ratio | times: 100 }}%;"{% endif %}>
                    <img class="img-fluid mx-auto lazyload"
                      srcset="{%- if media.preview_image.width >= 165 -%}{{ media.preview_image | image_url: width: 165 }} 165w,{%- endif -%}
                        {%- if media.preview_image.width >= 360 -%}{{ media.preview_image | image_url: width: 360 }} 360w,{%- endif -%}
                        {%- if media.preview_image.width >= 493 -%}{{ media.preview_image | image_url: width: 493 }} 493w,{%- endif -%}
                        {%- if media.preview_image.width >= 600 -%}{{ media.preview_image | image_url: width: 600 }} 600w,{%- endif -%}
                        {%- if media.preview_image.width >= 713 -%}{{ media.preview_image | image_url: width: 713 }} 713w,{%- endif -%}
                        {%- if media.preview_image.width >= 823 -%}{{ media.preview_image | image_url: width: 823 }} 823w,{%- endif -%}
                        {%- if media.preview_image.width >= 992 -%}{{ media.preview_image | image_url: width: 992 }} 992w,{%- endif -%}
                        {%- if media.preview_image.width >= 1100 -%}{{ media.preview_image | image_url: width: 1100 }} 1100w,{%- endif -%}
                        {%- if media.preview_image.width >= 1206 -%}{{ media.preview_image | image_url: width: 1206 }} 1206w,{%- endif -%}
                        {%- if media.preview_image.width >= 1346 -%}{{ media.preview_image | image_url: width: 1346 }} 1346w,{%- endif -%}
                        {%- if media.preview_image.width >= 1426 -%}{{ media.preview_image | image_url: width: 1426 }} 1426w,{%- endif -%}
                        {%- if media.preview_image.width >= 1646 -%}{{ media.preview_image | image_url: width: 1646 }} 1646w,{%- endif -%}
                        {%- if media.preview_image.width >= 1946 -%}{{ media.preview_image | image_url: width: 1946 }} 1946w,{%- endif -%}
                        {{ media.preview_image | image_url }} {{ media.preview_image.width }}w"
                      src="{{ media.preview_image | image_url: width: 370 }} 370w"
                      sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 992px) calc((100vw - 130px) / 4), (min-width: 768px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                      loading="lazy"
                      width="{{ media.preview_image.width }}"
                      height="{{ media.preview_image.height }}"
                      alt="{{ media.preview_image.alt | escape }}">
                    {%- if card_product.media[1] != nil and show_secondary_image -%}
                      <img srcset="{%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | image_url: width: 165 }} 165w,{%- endif -%}
                        {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | image_url: width: 360 }} 360w,{%- endif -%}
                        {%- if card_product.media[1].width >= 493 -%}{{ card_product.media[1] | image_url: width: 493 }} 493w,{%- endif -%}
                        {%- if card_product.media[1].width >= 600 -%}{{ card_product.media[1] | image_url: width: 600 }} 600w,{%- endif -%}
                        {%- if card_product.media[1].width >= 713 -%}{{ card_product.media[1] | image_url: width: 713 }} 713w,{%- endif -%}
                        {%- if card_product.media[1].width >= 823 -%}{{ card_product.media[1] | image_url: width: 823 }} 823w,{%- endif -%}
                        {%- if card_product.media[1].width >= 992 -%}{{ card_product.media[1] | image_url: width: 992 }} 992w,{%- endif -%}
                        {{ card_product.media[1] | image_url }} {{ card_product.media[1].width }}w"
                        src="{{ card_product.media[1] | image_url: width: 370 }}"
                        alt="{{ card_product.media[1].alt | escape }}"
                        sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 992px) calc((100vw - 130px) / 4), (min-width: 768px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                        class="motion-reduce img-fluid mx-auto lazyload"
                        loading="lazy"
                        width="{{ card_product.media[1].width }}"
                        height="{{ card_product.media[1].height }}">
                      {%- endif -%}
                  </a>
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>
        {%- endif -%}

        {%- liquid
          if show_variants
            assign target = card_product.selected_or_first_available_variant
          else
            assign target = card_product
          endif
          assign compare_at_price = target.compare_at_price
          assign price = target.price | default: 1999
          if compare_at_price > price
            assign price_difference_percent = compare_at_price | minus: price | times: 100 | divided_by: compare_at_price | round
            if settings.currency_code_enabled
              assign price_difference_amount = compare_at_price | minus: price | money_with_currency
            else
              assign price_difference_amount = compare_at_price | minus: price | money
            endif
          endif
        -%}
        <div class="card__badge {% if settings.percentage == false and settings.diff_price == false %}only_new{% endif %}">
          {% for tags in card_product.tags %}
            {% assign new_badge = tags | downcase %}
            {% if new_badge == 'new' %}
              {% unless settings.new_marquee %}
              <span class="{% if card_product.featured_media == blank and card_product.selected_or_first_available_variant.available %} badge_postion {% endif %} badge new_product_badge{% if show_quick_add and quick_position == 'top-right' %} with_quick_look{% endif %}">{{- 'products.product.new' | t -}}</span>
              {% else %}
              <marquee class="{% if card_product.featured_media == blank and card_product.selected_or_first_available_variant.available %} badge_postion {% endif %}new_product_badge{% if show_quick_add and quick_position != 'top-right' %} marquee-spacing{% endif %}{% if atc_btn_position == 'on_img' %} marquee-atc-spacing{% endif %}">
                {% for i in (1..30) %}
                  <span>{{- 'products.product.new' | t -}}</span>
                {% endfor %}
              </marquee>
            {% endunless %}
            {% endif %}
          {% endfor %}
          
          {%- if show_quick_add -%}
            <div class="{% if card_product.featured_media == blank and card_product.selected_or_first_available_variant.available %} badge_postion {% endif %} quick-add no-js-hidden quick_add_position-{{ quick_position }} {% if atc_btn_position == 'on_img' %} quick_look_position {% endif %} {% if on_img_on_hover %}on_img_on_hover_quicklook {% endif %}">
              {%- assign product_form_id = 'quick-add-' | append: section_id | append: card_product.id -%}
              <modal-opener data-modal="#QuickAdd-{{ card_product.id }}">
                <button id="{{ product_form_id }}-submit" type="submit" name="add" class="quick-add__submit button button--full-width{% if horizontal_quick_add %} card--horizontal__quick-add animate-arrow{% endif %}" aria-haspopup="dialog" aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}" data-product-url="{{ card_product.url }}" >
                  <span>{{ 'products.product.quick_look' | t }}
                  {%- if horizontal_quick_add -%}
                    <span class="icon-wrap">{% render 'icon-arrow' %}</span>
                  {%- endif -%}</span>
                    {% render 'icon-quickview' %}
                  <span class="loading-overlay__spinner hidden">
                    <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"><circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle></svg>  
                  </span>
                </button>
              </modal-opener>
              <quick-add-modal id="QuickAdd-{{ card_product.id }}" class="quick-add-modal">
                <div role="dialog" aria-label="{{ 'products.product.choose_product_options' | t: product_name: card_product.title | escape }}" aria-modal="true" class="quick-add-modal__content global-settings-popup" tabindex="-1" >
                  <button id="ModalClose-{{ card_product.id }}" type="button" class="quick-add-modal__toggle" aria-label="{{ 'accessibility.close' | t }}">
                    {% render 'icon-close' %}
                  </button>
                  <div id="QuickAddInfo-{{ card_product.id }}" class="quick-add-modal__content-info"></div>
                </div>
              </quick-add-modal>
            </div>
          {%- endif -%}
          {%- if card_product.available == false -%}
            <div class="wbsold_img"><span class="button soldout_product_badge">{{- 'products.product.sold_out' | t -}}</span></div>
          {%- endif -%} 
          {% if settings.percentage == true %}
            <span class="{% if card_product.featured_media == blank and card_product.selected_or_first_available_variant.available %} badge_postion {% endif %}badge percent__badge-sale {% if price_difference_percent == null %}hidden{% endif %}">
              {{ price_difference_percent }}{{ 'products.product.off_price' | t }}
            </span>
          {% endif %}
          {% if settings.diff_price == true %} 
            <span class="{% if card_product.featured_media == blank and card_product.selected_or_first_available_variant.available %} badge_postion {% endif %}{% if settings.percentage == false %}save_top{% endif %} badge amount__badge-sale {% if price_difference_amount == null %}hidden{% endif %}">{{- 'products.product.save' | t -}} {{ price_difference_amount }} </span>
          {%- endif -%}
        </div>
      </div>
      <div class="wbproductdes card__content">
        <product-info id="ProductInfo-{{ section.id }}-{{ card_product.id }}" data-section-input="{{ section.id }}" data-section="{{ section.id }}-{{ card_product.id }}" data-layout="card" data-url="{{ card_product.url }}">
          <input type="hidden" name="id" class="product-variant-id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
          {%- assign product_form_id = 'product-form-' | append: section.id | append: '-' | append: card_product.id -%}

            <div class="card__information">
              {%- unless card_product.has_only_default_variant -%}
                {% if show_colorvariant == true and show_variants == false %}
                  <variant-hover class="no-js-hidden new-swatch variant-webi" data-section="{{ section.id }}" data-product="{{ card_product.id }}" data-url="{{ card_product.url }}" data-update-url="false" data-layout="card" {{ block.shopify_attributes }}>
                      {%- for option in card_product.options_with_values -%}
                        <fieldset {% if option.name == 'Color' and show_colorvariant %} class="js product_form_input swatchComponent inner-class parent-display" {% else %} class="hidden" {% endif %}>
                          <div class="wbswatchclr">
                            {%- liquid
                              assign variants_available_arr = card_product.variants | map: 'available'
                              assign variants_option1_arr = card_product.variants | map: 'option1'
                              assign variants_option2_arr = card_product.variants | map: 'option2'
                              assign variants_option3_arr = card_product.variants | map: 'option3'
                              assign product_form_id = 'product-form-' | append: section.id
                            -%}
                            {%- for value in option.values -%}
                              {%- liquid
                                assign option_disabled = true
                                for option1_name in variants_option1_arr
                                  case option.position
                                    when 1
                                      if variants_option1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                          assign option_disabled = false
                                      endif
                                    when 2
                                      if option1_name == card_product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                          assign option_disabled = false
                                      endif
                                    when 3
                                      if option1_name == card_product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == card_product.selected_or_first_available_variant.option2 and variants_option3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                          assign option_disabled = false
                                      endif
                                  endcase
                                endfor
                              -%}
                              <input type="radio" id="{{ section.id }}-{{ card_product.id }}-{{ option.position }}-{{ forloop.index0 }}" name="{{ option.name }}-{{ section.id }}-{{ card_product.id }}" value="{{ value | escape }}" aria-label="Options" form="{{ product_form_id }}-{{ card_product.id }}" {% if option.selected_value == value %}checked{% endif %}{% if option_disabled %} class="disabled"{% endif %}>
                                {% if option.name == 'Color' and show_colorvariant %}
                                  {%- liquid
                                    assign color_file_name = value | handle | append: '.' | append: 'png'
                                    assign swatchimage = color_file_name | file_img_url: '50x50' | prepend: 'https:' | split: '?' | first
                                    assign colorswatchvalue = value | downcase | replace: ' ', ''
                                    assign color_code = settings.configuration | downcase | split: " " | where: colorswatchvalue
                                    if color_code != blank
                                      assign colorswatchvalue = color_code | split: ':' | last | remove: '"]'
                                    endif
                                -%}
                                  <label data-href="{{ card_product.url }}" class="color-swatchimg color-swatch {% if option.selected_value == value %} active{% endif %}" for="{{ section.id }}-{{ card_product.id }}-{{ option.position }}-{{ forloop.index0 }}" data-val="{{ value }}" style="background-color: {{ colorswatchvalue }};{% if images[color_file_name] != blank %}  background-image: url({{ swatchimage }});background-size: cover;{% endif %}"></label>
                                {% endif %}
                            {% endfor %}
                            </div>
                        </fieldset>
                      {% endfor -%}
                      <script type="application/json">
                        {{ card_product.variants | json }}
                      </script>
                    </variant-hover> 
              {% endif %}
              {%- endunless -%}
              {%- if show_vendor -%}<div class="product__vendor {% if show_colorvariant == true and show_variants == false %} top-spacing {% endif %}">{{ card_product.vendor }}</div>{%- endif -%}
              {% if enable_price_below %}
                <h3 class="card__heading{% if card_product.featured_media or settings.card_style == 'standard' %} h5{% endif %}" {% if card_product.featured_media or settings.card_style == 'card' %} id="title-{{ section_id }}-{{ card_product.id }}" {% endif %}>
                  <a href="{{ card_product.url | default: '#' }}" id="CardLink-{{ section_id }}-{{ card_product.id }}" class="full-unstyled-link" aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }} Badge-{{ section_id }}-{{ card_product.id }}" >
                    {{ card_product.title | escape }}
                  </a>
              </h3>
            {% endif %}
              <div class="card-information">
                <span class="caption-large light">{{ block.settings.description | escape }}</span>
                <div class="no-js-hidden wbhprice" id="price-{{ section.id }}-{{ card_product.id }}" role="status" {{ block.shopify_attributes }}>
                    {%- if show_variants == false -%}
                      {%- render 'price', product: card_product, use_variant: false, show_badges: false -%}
                    {%- else -%}
                      {%- render 'price', product: card_product, use_variant: true, show_badges: false -%}
                    {%- endif -%}
                </div>
                {%- if card_product.quantity_price_breaks_configured? -%}
                  <div class="card__information-volume-pricing-note">
                    <span class="caption">{{ 'products.product.volume_pricing.note' | t }}</span>
                  </div>
                {%- endif -%}

                
              </div>
              {% unless enable_price_below %}
                <h3 class="card__heading{% if card_product.featured_media or settings.card_style == 'standard' %} h5{% endif %}" {% if card_product.featured_media or settings.card_style == 'card' %} id="title-{{ section_id }}-{{ card_product.id }}" {% endif %}>
                  <a href="{{ card_product.url | default: '#' }}" id="CardLink-{{ section_id }}-{{ card_product.id }}" class="full-unstyled-link" aria-labelledby="CardLink-{{ section_id }}-{{ card_product.id }} Badge-{{ section_id }}-{{ card_product.id }}" >
                    {{ card_product.title | escape }}
                  </a>
                </h3> 
              {% endunless %}
              
              {%- if enable_listdesc and card_product.description != blank -%}
                <p class="wblistpdesc">{{ card_product.description | strip_html | truncatewords: 26 }}</p>
              {%- endif -%}
              {%- if show_rating -%}
                {% if settings.review_app == 'default' %}
                  {%- if card_product.metafields.reviews.rating.value != blank -%}
                    <div class="wbhrating">
                        {% liquid
                        assign rating_decimal = 0 
                        assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1 
                        if decimal >= 0.3 and decimal <= 0.7
                        assign rating_decimal = 0.5
                        elsif decimal > 0.7
                        assign rating_decimal = 1
                        endif 
                        %}
                        <div class="rating" role="img" aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: card_product.metafields.reviews.rating.value, rating_max: card_product.metafields.reviews.rating.value.scale_max }}">
                            <span aria-hidden="true" class="rating-star" style="--rating: {{ card_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ card_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"></span>
                        </div>
                        <p class="rating-text caption">
                            <span aria-hidden="true">{{ card_product.metafields.reviews.rating.value }} / {{ card_product.metafields.reviews.rating.value.scale_max }}</span>
                        </p>
                        <p class="rating-count caption">
                            <span aria-hidden="true">({{ card_product.metafields.reviews.rating_count }})</span>
                            <span class="visually-hidden">{{ card_product.metafields.reviews.rating_count }} {{ "accessibility.total_reviews" | t }}</span>
                        </p>
                    </div>
                  {%- else -%}
                  <div class="wbhrating">
                    <div class="rating"><span class="rating-star wbnorating"></span></div>
                    <p class="rating-count caption"><span aria-hidden="true">(0)</span></p>
                  </div>
                  {%- endif -%}
                {% elsif settings.review_app == 'judgeme' %}
                  <div class="wbhrating">
                    <div class="rating">
                      <div class='jdgm-widget jdgm-preview-badge'>
                        {{ card_product.metafields.judgeme.badge }}
                      </div>
                    </div>
                  </div>
                {% elsif settings.review_app == 'loox' %}
                <div class="wbhrating">
                  <div class="rating">
                    <div class="loox-rating" data-id="{{ card_product.id }}" data-rating="{{ card_product.metafields.loox.avg_rating }}" data-raters="{{ card_product.metafields.loox.num_reviews }}"></div>
                  </div>
                </div>
                {% elsif settings.review_app == 'wisernotify' %}
                <div class="wbhrating">
                  <div class="rating">
                {% render 'wnreview_widgets', widget_type: 'wnreview_star_rating', card_product: product %}
                  </div>
                  </div>
                {% elsif settings.review_app == 'okendo' %}
                    <div class="wbhrating">
                      <div class="rating">
                        {% capture product_data_attribute %}data-oke-reviews-product-id="shopify-{{ card_product.id }}"{% endcapture %} 
                        <div data-oke-star-rating {{ product_data_attribute }}>{{ card_product.metafields.okendo.StarRatingSnippet }}</div>
                      </div>
                  </div>
                {% endif %}
              {%- endif -%}



              {% if show_quantity == true %}
                <div class="wbform_qty">
                  <label class="quantity__label form__label">{{ 'products.product.quantity.label' | t }}</label>
                  <div class="price-per-item__container">
                    <quantity-input class="quantity">
                      <button class="quantity__button no-js-hidden" name="minus" type="button">
                        <span class="visually-hidden">
                          {{- 'products.product.quantity.decrease' | t: card_product: card_product.title | escape -}}
                        </span>
                        {% render 'icon-minus' %}
                      </button>
                      <input class="quantity__input"
                        type="number"
                        name="quantity"
                        id="Quantity-{{ section.id }}-{{ card_product.id }}"
                        data-cart-quantity="{{ cart_qty }}"
                        data-min="{{ card_product.selected_or_first_available_variant.quantity_rule.min }}"
                        min="{{ card_product.selected_or_first_available_variant.quantity_rule.min }}"
                        {% if card_product.selected_or_first_available_variant.quantity_rule.max != null %}
                          data-max="{{ card_product.selected_or_first_available_variant.quantity_rule.max }}"
                          max="{{ card_product.selected_or_first_available_variant.quantity_rule.max }}"
                        {% endif %}
                        step="{{ card_product.selected_or_first_available_variant.quantity_rule.increment }}"
                        value="{{ card_product.selected_or_first_available_variant.quantity_rule.min }}"
                        form="{{ product_form_id }}"
                      >
                      <button class="quantity__button no-js-hidden" name="plus" type="button">
                        <span class="visually-hidden">
                          {{- 'products.product.quantity.increase' | t: card_product: card_product.title | escape -}}
                        </span>
                        {% render 'icon-plus' %}
                      </button>
                    </quantity-input>
                  </div>
                </div>
              {% endif %}
            
              {%- unless card_product.has_only_default_variant -%}
                {%- if show_variants %}
                  {%- if picker_type == 'button' -%}
                    <variant-radios class="no-js-hidden new-swatch variant-webi" data-section="{{ section.id }}" data-product="{{ card_product.id }}" data-url="{{ card_product.url }}" data-update-url="false" data-layout="card" {{ block.shopify_attributes }}>
                      {%- for option in card_product.options_with_values -%}
                        <fieldset {% if option.name == 'Color' and show_colorswatch %} class="js product_form_input swatchComponent inner-class" {% else %} class="js product-form__input product_form_input inner-class" {% endif %}>
                          <legend class="form__label">{{ option.name }}:
                            {% assign current_variant = card_product.selected_or_first_available_variant %}
                            {% if current_variant.option.selected_value != '' %}
                              <span>{{ option.selected_value }}</span>
                            {% endif %}
                         </legend>
                          {% if option.name == 'Color' and show_colorswatch %} <div class="wbswatchclr"> {% endif %}
                            {%- liquid
                              assign variants_available_arr = card_product.variants | map: 'available'
                              assign variants_option1_arr = card_product.variants | map: 'option1'
                              assign variants_option2_arr = card_product.variants | map: 'option2'
                              assign variants_option3_arr = card_product.variants | map: 'option3'
                              assign product_form_id = 'product-form-' | append: section.id
                            -%}
                            {%- for value in option.values -%}
                              {%- liquid
                                assign option_disabled = true
                                for option1_name in variants_option1_arr
                                  case option.position
                                    when 1
                                      if variants_option1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                          assign option_disabled = false
                                      endif
                                    when 2
                                      if option1_name == card_product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                          assign option_disabled = false
                                      endif
                                    when 3
                                      if option1_name == card_product.selected_or_first_available_variant.option1 and variants_option2_arr[forloop.index0] == card_product.selected_or_first_available_variant.option2 and variants_option3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
                                          assign option_disabled = false
                                      endif
                                  endcase
                                endfor
                              -%}
                              <input type="radio" id="{{ section.id }}-{{ card_product.id }}-{{ option.position }}-{{ forloop.index0 }}" name="{{ option.name }}" value="{{ value | escape }}" aria-label="Options" form="{{ product_form_id }}-{{ card_product.id }}" {% if option.selected_value == value %}checked{% endif %}{% if option_disabled %} class="disabled"{% endif %}>
                                {% if option.name == 'Color' and show_colorswatch %}
                                  {%- liquid
                                      assign color_file_name = value | handle | append: '.' | append: 'png'
                                      assign swatchimage = color_file_name | file_img_url: '50x50' | prepend: 'https:' | split: '?' | first
                                      assign colorswatchvalue = value | downcase | replace: ' ', ''
                                  -%}
                                  <label class="color-swatchimg color-swatch {% if option.selected_value == value %} active{% endif %}" for="{{ section.id }}-{{ card_product.id }}-{{ option.position }}-{{ forloop.index0 }}" data-val="{{ value }}" style="background-color: {{ colorswatchvalue }};{% if images[color_file_name] != blank %}  background-image: url({{ swatchimage }});{% endif %}"></label>
                                {% else %}
                                  <label class="color-swatch {% if option.selected_value == value %} active{% endif %}" for="{{ section.id }}-{{ card_product.id }}-{{ option.position }}-{{ forloop.index0 }}" data-val="{{ value }}">{{ value }}</label>
                                {% endif %}
                            {% endfor %}
                            {% if option.name == 'Color' and show_colorswatch %}</div>{% endif %}
                        </fieldset>
                      {% endfor -%}
                      <script type="application/json">
                        {{ card_product.variants | json }}
                      </script>
                    </variant-radios>
                  {%- else -%}
                    <variant-selects class="no-js-hidden" data-section="{{ section.id }}"
                      data-product="{{ card_product.id }}" data-url="{{ card_product.url }}"
                      data-update-url="false"
                      data-layout="card" {{ block.shopify_attributes }}>
                      {%- for option in card_product.options_with_values -%}
                        <div class="product-form__input product_form_input product-form__input--dropdown">
                          <legend class="form__label" for="Option-{{ section.id }}-{{ card_product.id }}-{{ forloop.index0 }}">{{ option.name }}:
                            {% assign current_variant = card_product.selected_or_first_available_variant %}
                            {% if current_variant.option.selected_value != '' %}
                              <span>{{ option.selected_value }}</span>
                            {% endif %}
                         </legend>
                          <div class="select">
                            <select id="Option-{{ section.id }}-{{ card_product.id }}-{{ forloop.index0 }}"
                              class="select__select"
                              name="options[{{ option.name | escape }}]"
                              aria-label="{{ option.name }}"
                              form="{{ product_form_id }}">
                              {%- for value in option.values -%}
                                <option data-val="{{ value }}" value="{{ value | escape }}"
                                  {% if option.selected_value == value %}selected="selected"{% endif %}>
                                    {{ value }}
                                </option>
                              {%- endfor -%}
                            </select>
                            {% render 'icon-caret' %}
                          </div>
                        </div>
                      {%- endfor -%}
                      <script type="application/json">
                         {{ card_product.variants | json }}
                      </script>
                    </variant-selects>
                  {%- endif -%}
                {%- endif -%}
              {% endunless %}
              <select name="id" id="Variants-{{ section.id }}-{{ card_product.id }}" class="select__select no-js" form="{{ product_form_id }}">
                {%- for variant in card_product.variants -%}
                  {%- liquid
                    if variant.compare_at_price > variant.price
                      assign price_difference_percent = variant.compare_at_price | minus: variant.price | times: 100 | divided_by: variant.compare_at_price | round
                      assign price_difference_amount = variant.compare_at_price | minus: variant.price | money_with_currency
                    endif
                  -%}
                  <option data-v-title="{{ variant.title }}"
                    data-unitprice="{% if settings.currency_code_enabled %}{{ variant.unit_price | money_with_currency }}{% else %}{{ variant.unit_price | money }}{% endif %}"
                    data-unitvalue="{% if variant.unit_price_measurement.reference_value != 1 %}{{ variant.unit_price_measurement.reference_value }}{% endif %}{{ variant.unit_price_measurement.reference_unit }}"
                    data-price="{% if settings.currency_code_enabled %}{{ variant.price | money_with_currency }}{% else %}{{ variant.price | money }}{% endif %}"
                    data-cprice="{% if settings.currency_code_enabled %}{{ variant.compare_at_price | money_with_currency }}{% else %}{{ variant.compare_at_price | money }}{% endif %}"
                    data-percent="{% if settings.percentage == true and price_difference_percent != null %}{{ price_difference_percent }}{{ 'products.product.off_price' | t }}{% endif %}"
                    data-damount="{% if settings.diff_price == true and price_difference_amount != null %}{{- 'products.product.save' | t -}} {{ price_difference_amount }}{% endif %}"

                    {% if variant == card_product.selected_or_first_available_variant %}selected="selected"{% endif %}
                    {% if variant.available == false %}disabled{% endif %} value="{{ variant.id }}">
                    {{ variant.title }}
                    {%- if variant.available == false %} - {{ 'products.product.sold_out' | t }}{% endif %}
                    - {{ variant.price | money | strip_html }}
                  </option>
                {%- endfor -%}
              </select>

            </div>
        </product-info> 
        {% comment %} Cart Button Start {% endcomment %}
        <product-form class="no-js-hidden" id="ProductInfo-{{ section.id }}-{{ card_product.id }}">
          {%- assign product_form_id = 'product-form-' | append: section.id | append: '-' | append: card_product.id -%}
          {%- form 'product', card_product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
            <input type="hidden" name="id" class="product-variant-id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
            {% if atc_btn_position == 'bottom' %}
              {% if card_product.has_only_default_variant or show_variants == true %}
                <button id="{{ product_form_id }}-submit" type="submit" name="add"
                  class="add-to-cart__submit button button--primary" aria-haspopup="dialog"
                  aria-labelledby="{{ product_form_id }}-submit title-{{ section_id }}-{{ card_product.id }}"
                  aria-live="polite"
                  data-sold-out-message="true" {% if card_product.selected_or_first_available_variant.available == false %} disabled {% endif %}>
                  {%- if card_product.selected_or_first_available_variant.available -%}
                    <span>{{ 'products.product.add_to_cart' | t }}</span>
                    {% render 'icon-hcartbag' %}
                  {%- else -%}
                    <span>{{ 'products.product.sold_out' | t }}</span>
                    {% render 'icon-hcartbag' %}
                  {%- endif -%}
                  <span class="sold-out-message hidden">{{ 'products.product.sold_out' | t }}</span>
                  <span class="loading-overlay__spinner hidden">
                    <svg aria-hidden="true" focusable="false" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg"> <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle> </svg>
                  </span>
                </button>
                {% else %}
                <a href="{{ card_product.url }}" class="add-to-cart__submit button"><span>{{ 'products.product.select_option' | t }}</span></a>
            {% endif %}
              {% endif %}
              {%- endform -%}
            </product-form>
          {% comment %} Cart Button End {% endcomment %}
      </div>
    </div>
  </div>
{%- else -%}
  <div class="card-wrapper wbproduct-container product-card-wrapper {% if settings.var_pill_style == 'button' %}background_pill{% endif %}">
     <div class="card card--{{ settings.card_style }}
        {% if extend_height %} card--extend-height{% endif %}
        {% if settings.card_style == 'card' %} color-{{ settings.card_color_scheme }} gradient{% endif %}"
      style="--ratio-percent: 100%;" >
      <div class="card__inner wbimgblock {% if settings.card_style == 'standard' %}color-{{ settings.card_color_scheme }} gradient{% endif %} ratio" style="--ratio-percent: 100%;">
        <div class="card__media">
          <div class="media media--transparent">
            {%- if placeholder_image -%}
              {{ placeholder_image | placeholder_svg_tag: 'placeholder-svg' }}
            {%- else -%}
              {{ 'product-apparel-2' | placeholder_svg_tag: 'placeholder-svg' }}
            {% endif %}
          </div>
        </div>
      </div>
        
      <div class="card__content wbproductdes">
        <div class="card__information">
          {%- if show_vendor -%}
              <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
              <div class="product__vendor">{{ 'products.product.vendor' | t }}</div>
          {%- endif -%}
          <h3 class="card__heading h5">
            <a role="link" aria-disabled="true" class="full-unstyled-link">
                {{ 'onboarding.product_title' | t }}
            </a>
          </h3> 
          <div class="card-information">
            <span class="caption-large light">{{ block.settings.description | escape }}</span>
            <div class="wbhprice">
              {%- render 'price', product: card_product, use_variant: true, show_badges: true -%}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{%- endif -%}